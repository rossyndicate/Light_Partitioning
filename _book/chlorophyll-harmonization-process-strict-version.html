<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Chlorophyll harmonization process (strict version) | _main.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Chlorophyll harmonization process (strict version) | _main.knit" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Chlorophyll harmonization process (strict version) | _main.knit" />
  
  
  

<meta name="author" content="ROSSyndicate" />


<meta name="date" content="2023-04-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="pre-harmonization-decision-process.html"/>
<link rel="next" href="doc-harmonization-process-strict-version.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Light Partitioning</a></li>
<li class="chapter" data-level="2" data-path="download-process.html"><a href="download-process.html"><i class="fa fa-check"></i><b>2</b> Download process</a>
<ul>
<li class="chapter" data-level="2.0.1" data-path="download-process.html"><a href="download-process.html#catalogue-existing-data"><i class="fa fa-check"></i><b>2.0.1</b> Catalogue existing data</a></li>
<li class="chapter" data-level="2.0.2" data-path="download-process.html"><a href="download-process.html#maps-of-data-spread-within-the-contiguous-us"><i class="fa fa-check"></i><b>2.0.2</b> Maps of data spread within the contiguous US:</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="pre-harmonization-decision-process.html"><a href="pre-harmonization-decision-process.html"><i class="fa fa-check"></i><b>3</b> Pre-harmonization decision process</a>
<ul>
<li class="chapter" data-level="3.0.1" data-path="pre-harmonization-decision-process.html"><a href="pre-harmonization-decision-process.html#initial-dataset"><i class="fa fa-check"></i><b>3.0.1</b> 0. Initial dataset</a></li>
<li class="chapter" data-level="3.0.2" data-path="pre-harmonization-decision-process.html"><a href="pre-harmonization-decision-process.html#remove-duplicates"><i class="fa fa-check"></i><b>3.0.2</b> 1. Remove duplicates</a></li>
<li class="chapter" data-level="3.0.3" data-path="pre-harmonization-decision-process.html"><a href="pre-harmonization-decision-process.html#missing-results"><i class="fa fa-check"></i><b>3.0.3</b> 2. Missing results</a></li>
<li class="chapter" data-level="3.0.4" data-path="pre-harmonization-decision-process.html"><a href="pre-harmonization-decision-process.html#filter-status"><i class="fa fa-check"></i><b>3.0.4</b> 2. Filter status</a></li>
<li class="chapter" data-level="3.0.5" data-path="pre-harmonization-decision-process.html"><a href="pre-harmonization-decision-process.html#filter-media"><i class="fa fa-check"></i><b>3.0.5</b> 3. Filter media</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chlorophyll-harmonization-process-strict-version.html"><a href="chlorophyll-harmonization-process-strict-version.html"><i class="fa fa-check"></i><b>4</b> Chlorophyll harmonization process (strict version)</a>
<ul>
<li class="chapter" data-level="4.0.1" data-path="chlorophyll-harmonization-process-strict-version.html"><a href="chlorophyll-harmonization-process-strict-version.html#initial-dataset-1"><i class="fa fa-check"></i><b>4.0.1</b> 0. Initial dataset</a></li>
<li class="chapter" data-level="4.0.2" data-path="chlorophyll-harmonization-process-strict-version.html"><a href="chlorophyll-harmonization-process-strict-version.html#filter-for-water-media"><i class="fa fa-check"></i><b>4.0.2</b> 1. Filter for water media</a></li>
<li class="chapter" data-level="4.0.3" data-path="chlorophyll-harmonization-process-strict-version.html"><a href="chlorophyll-harmonization-process-strict-version.html#keep-only-chlorophyll-parameters"><i class="fa fa-check"></i><b>4.0.3</b> 2. Keep only chlorophyll parameters</a></li>
<li class="chapter" data-level="4.0.4" data-path="chlorophyll-harmonization-process-strict-version.html"><a href="chlorophyll-harmonization-process-strict-version.html#remove-fails-and-other-missing-data"><i class="fa fa-check"></i><b>4.0.4</b> 3. Remove fails and other missing data</a></li>
<li class="chapter" data-level="4.0.5" data-path="chlorophyll-harmonization-process-strict-version.html"><a href="chlorophyll-harmonization-process-strict-version.html#clean-mdls"><i class="fa fa-check"></i><b>4.0.5</b> 4. Clean MDLs</a></li>
<li class="chapter" data-level="4.0.6" data-path="chlorophyll-harmonization-process-strict-version.html"><a href="chlorophyll-harmonization-process-strict-version.html#clean-approximate-values"><i class="fa fa-check"></i><b>4.0.6</b> 5. Clean approximate values</a></li>
<li class="chapter" data-level="4.0.7" data-path="chlorophyll-harmonization-process-strict-version.html"><a href="chlorophyll-harmonization-process-strict-version.html#clean-values-with-greater-than-data"><i class="fa fa-check"></i><b>4.0.7</b> 6. Clean values with “greater than” data</a></li>
<li class="chapter" data-level="4.0.8" data-path="chlorophyll-harmonization-process-strict-version.html"><a href="chlorophyll-harmonization-process-strict-version.html#harmonize-record-units"><i class="fa fa-check"></i><b>4.0.8</b> 7. Harmonize record units</a></li>
<li class="chapter" data-level="4.0.9" data-path="chlorophyll-harmonization-process-strict-version.html"><a href="chlorophyll-harmonization-process-strict-version.html#clean-depth-data"><i class="fa fa-check"></i><b>4.0.9</b> 8. Clean depth data</a></li>
<li class="chapter" data-level="4.0.10" data-path="chlorophyll-harmonization-process-strict-version.html"><a href="chlorophyll-harmonization-process-strict-version.html#filter-based-on-analytical-method"><i class="fa fa-check"></i><b>4.0.10</b> 9. Filter based on analytical method</a></li>
<li class="chapter" data-level="4.0.11" data-path="chlorophyll-harmonization-process-strict-version.html"><a href="chlorophyll-harmonization-process-strict-version.html#filter-based-on-fraction-type"><i class="fa fa-check"></i><b>4.0.11</b> 10. Filter based on fraction type</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="doc-harmonization-process-strict-version.html"><a href="doc-harmonization-process-strict-version.html"><i class="fa fa-check"></i><b>5</b> DOC harmonization process (strict version)</a>
<ul>
<li class="chapter" data-level="5.0.1" data-path="doc-harmonization-process-strict-version.html"><a href="doc-harmonization-process-strict-version.html#initial-dataset-2"><i class="fa fa-check"></i><b>5.0.1</b> 0. Initial dataset</a></li>
<li class="chapter" data-level="5.0.2" data-path="doc-harmonization-process-strict-version.html"><a href="doc-harmonization-process-strict-version.html#filter-for-water-media-1"><i class="fa fa-check"></i><b>5.0.2</b> 1. Filter for water media</a></li>
<li class="chapter" data-level="5.0.3" data-path="doc-harmonization-process-strict-version.html"><a href="doc-harmonization-process-strict-version.html#remove-fails-and-other-missing-data-1"><i class="fa fa-check"></i><b>5.0.3</b> 2. Remove fails and other missing data</a></li>
<li class="chapter" data-level="5.0.4" data-path="doc-harmonization-process-strict-version.html"><a href="doc-harmonization-process-strict-version.html#clean-mdls-1"><i class="fa fa-check"></i><b>5.0.4</b> 3. Clean MDLs</a></li>
<li class="chapter" data-level="5.0.5" data-path="doc-harmonization-process-strict-version.html"><a href="doc-harmonization-process-strict-version.html#clean-approximate-values-1"><i class="fa fa-check"></i><b>5.0.5</b> 4. Clean approximate values</a></li>
<li class="chapter" data-level="5.0.6" data-path="doc-harmonization-process-strict-version.html"><a href="doc-harmonization-process-strict-version.html#harmonize-record-units-1"><i class="fa fa-check"></i><b>5.0.6</b> 5. Harmonize record units</a></li>
<li class="chapter" data-level="5.0.7" data-path="doc-harmonization-process-strict-version.html"><a href="doc-harmonization-process-strict-version.html#filter-based-on-analytical-method-1"><i class="fa fa-check"></i><b>5.0.7</b> 6. Filter based on analytical method</a></li>
<li class="chapter" data-level="5.0.8" data-path="doc-harmonization-process-strict-version.html"><a href="doc-harmonization-process-strict-version.html#filter-based-on-fraction-type-1"><i class="fa fa-check"></i><b>5.0.8</b> 7. Filter based on fraction type</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="secchi-harmonization-process-strict-version.html"><a href="secchi-harmonization-process-strict-version.html"><i class="fa fa-check"></i><b>6</b> Secchi harmonization process (strict version)</a>
<ul>
<li class="chapter" data-level="6.0.1" data-path="secchi-harmonization-process-strict-version.html"><a href="secchi-harmonization-process-strict-version.html#initial-dataset-3"><i class="fa fa-check"></i><b>6.0.1</b> 0. Initial dataset</a></li>
<li class="chapter" data-level="6.0.2" data-path="secchi-harmonization-process-strict-version.html"><a href="secchi-harmonization-process-strict-version.html#filter-for-water-media-2"><i class="fa fa-check"></i><b>6.0.2</b> 1. Filter for water media</a></li>
<li class="chapter" data-level="6.0.3" data-path="secchi-harmonization-process-strict-version.html"><a href="secchi-harmonization-process-strict-version.html#remove-fails-and-other-missing-data-2"><i class="fa fa-check"></i><b>6.0.3</b> 2. Remove fails and other missing data</a></li>
<li class="chapter" data-level="6.0.4" data-path="secchi-harmonization-process-strict-version.html"><a href="secchi-harmonization-process-strict-version.html#clean-mdls-2"><i class="fa fa-check"></i><b>6.0.4</b> 3. Clean MDLs</a></li>
<li class="chapter" data-level="6.0.5" data-path="secchi-harmonization-process-strict-version.html"><a href="secchi-harmonization-process-strict-version.html#clean-approximate-values-2"><i class="fa fa-check"></i><b>6.0.5</b> 4. Clean approximate values</a></li>
<li class="chapter" data-level="6.0.6" data-path="secchi-harmonization-process-strict-version.html"><a href="secchi-harmonization-process-strict-version.html#clean-values-with-greater-than-data-1"><i class="fa fa-check"></i><b>6.0.6</b> 5. Clean values with “greater than” data</a></li>
<li class="chapter" data-level="6.0.7" data-path="secchi-harmonization-process-strict-version.html"><a href="secchi-harmonization-process-strict-version.html#harmonize-record-units-2"><i class="fa fa-check"></i><b>6.0.7</b> 6. Harmonize record units</a></li>
<li class="chapter" data-level="6.0.8" data-path="secchi-harmonization-process-strict-version.html"><a href="secchi-harmonization-process-strict-version.html#filter-based-on-analytical-method-2"><i class="fa fa-check"></i><b>6.0.8</b> 7. Filter based on analytical method</a></li>
<li class="chapter" data-level="6.0.9" data-path="secchi-harmonization-process-strict-version.html"><a href="secchi-harmonization-process-strict-version.html#filter-based-on-fraction-type-2"><i class="fa fa-check"></i><b>6.0.9</b> 8. Filter based on fraction type</a></li>
<li class="chapter" data-level="6.0.10" data-path="secchi-harmonization-process-strict-version.html"><a href="secchi-harmonization-process-strict-version.html#filter-based-on-sample-method"><i class="fa fa-check"></i><b>6.0.10</b> 9. Filter based on sample method</a></li>
<li class="chapter" data-level="6.0.11" data-path="secchi-harmonization-process-strict-version.html"><a href="secchi-harmonization-process-strict-version.html#filter-based-on-collection-equipment"><i class="fa fa-check"></i><b>6.0.11</b> 10. Filter based on collection equipment</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="tss-harmonization-process-strict-version.html"><a href="tss-harmonization-process-strict-version.html"><i class="fa fa-check"></i><b>7</b> TSS harmonization process (strict version)</a>
<ul>
<li class="chapter" data-level="7.0.1" data-path="tss-harmonization-process-strict-version.html"><a href="tss-harmonization-process-strict-version.html#initial-dataset-4"><i class="fa fa-check"></i><b>7.0.1</b> 0. Initial dataset</a></li>
<li class="chapter" data-level="7.0.2" data-path="tss-harmonization-process-strict-version.html"><a href="tss-harmonization-process-strict-version.html#filter-for-water-media-3"><i class="fa fa-check"></i><b>7.0.2</b> 1. Filter for water media</a></li>
<li class="chapter" data-level="7.0.3" data-path="tss-harmonization-process-strict-version.html"><a href="tss-harmonization-process-strict-version.html#remove-fails-and-other-missing-data-3"><i class="fa fa-check"></i><b>7.0.3</b> 2. Remove fails and other missing data</a></li>
<li class="chapter" data-level="7.0.4" data-path="tss-harmonization-process-strict-version.html"><a href="tss-harmonization-process-strict-version.html#clean-mdls-3"><i class="fa fa-check"></i><b>7.0.4</b> 3. Clean MDLs</a></li>
<li class="chapter" data-level="7.0.5" data-path="tss-harmonization-process-strict-version.html"><a href="tss-harmonization-process-strict-version.html#clean-approximate-values-3"><i class="fa fa-check"></i><b>7.0.5</b> 4. Clean approximate values</a></li>
<li class="chapter" data-level="7.0.6" data-path="tss-harmonization-process-strict-version.html"><a href="tss-harmonization-process-strict-version.html#clean-values-with-greater-than-data-2"><i class="fa fa-check"></i><b>7.0.6</b> 5. Clean values with “greater than” data</a></li>
<li class="chapter" data-level="7.0.7" data-path="tss-harmonization-process-strict-version.html"><a href="tss-harmonization-process-strict-version.html#harmonize-record-units-3"><i class="fa fa-check"></i><b>7.0.7</b> 6. Harmonize record units</a></li>
<li class="chapter" data-level="7.0.8" data-path="tss-harmonization-process-strict-version.html"><a href="tss-harmonization-process-strict-version.html#filter-based-on-analytical-method-3"><i class="fa fa-check"></i><b>7.0.8</b> 7. Filter based on analytical method</a></li>
<li class="chapter" data-level="7.0.9" data-path="tss-harmonization-process-strict-version.html"><a href="tss-harmonization-process-strict-version.html#filter-based-on-fraction-type-3"><i class="fa fa-check"></i><b>7.0.9</b> 8. Filter based on fraction type</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="light-partitioning-modeling-report.html"><a href="light-partitioning-modeling-report.html"><i class="fa fa-check"></i><b>8</b> Light partitioning modeling report</a>
<ul>
<li class="chapter" data-level="8.0.1" data-path="light-partitioning-modeling-report.html"><a href="light-partitioning-modeling-report.html#overview-of-simultaneous-records"><i class="fa fa-check"></i><b>8.0.1</b> Overview of simultaneous records</a></li>
<li class="chapter" data-level="8.0.2" data-path="light-partitioning-modeling-report.html"><a href="light-partitioning-modeling-report.html#comparisons-against-mrs-aquasat-1-version"><i class="fa fa-check"></i><b>8.0.2</b> Comparisons against MR’s AquaSat 1 version:</a></li>
<li class="chapter" data-level="8.0.3" data-path="light-partitioning-modeling-report.html"><a href="light-partitioning-modeling-report.html#modeling"><i class="fa fa-check"></i><b>8.0.3</b> Modeling</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chlorophyll-harmonization-process-strict-version" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Chlorophyll harmonization process (strict version)<a href="chlorophyll-harmonization-process-strict-version.html#chlorophyll-harmonization-process-strict-version" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="initial-dataset-1" class="section level3 hasAnchor" number="4.0.1">
<h3><span class="header-section-number">4.0.1</span> 0. Initial dataset<a href="chlorophyll-harmonization-process-strict-version.html#initial-dataset-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>After the preharmonization process the chlorophyll-only WQP dataset
contains 3.41 million rows.</p>
<p><img src="chapters/03_chla_harmonization_files/figure-gfm/unnamed-chunk-4-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="filter-for-water-media" class="section level3 hasAnchor" number="4.0.2">
<h3><span class="header-section-number">4.0.2</span> 1. Filter for water media<a href="chlorophyll-harmonization-process-strict-version.html#filter-for-water-media" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first step in chla harmonization is to ensure that the media type
for the data is <code>"water"</code> or <code>"Water"</code>. This should just be a
precautionary step: 0 rows are removed. The final row count after this
is 3.41 million.</p>
<p><img src="chapters/03_chla_harmonization_files/figure-gfm/unnamed-chunk-6-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="keep-only-chlorophyll-parameters" class="section level3 hasAnchor" number="4.0.3">
<h3><span class="header-section-number">4.0.3</span> 2. Keep only chlorophyll parameters<a href="chlorophyll-harmonization-process-strict-version.html#keep-only-chlorophyll-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The next step is to ensure that there are only parameter names related
to chlorophyll a in the dataset. We retain the following values:</p>
<ul>
<li><code>Chlorophyll a</code></li>
<li><code>Chlorophyll a (probe relative fluorescence)</code></li>
<li><code>Chlorophyll a, corrected for pheophytin</code></li>
<li><code>Chlorophyll a (probe)</code></li>
<li><code>Chlorophyll a, free of pheophytin</code></li>
<li><code>Chlorophyll a - Phytoplankton (suspended)</code></li>
</ul>
<p>1.29 million rows are removed and 2.12 million rows remain.</p>
<p><img src="chapters/03_chla_harmonization_files/figure-gfm/unnamed-chunk-8-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="remove-fails-and-other-missing-data" class="section level3 hasAnchor" number="4.0.4">
<h3><span class="header-section-number">4.0.4</span> 3. Remove fails and other missing data<a href="chlorophyll-harmonization-process-strict-version.html#remove-fails-and-other-missing-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this step we filter out records based on indications that they have
failed data for some reason. We screen the following columns:
<code>ActivityCommentText</code>, <code>ResultLaboratoryCommentText</code>,
<code>ResultCommentText</code>, and <code>ResultMeasureValue</code>. Examples of text that
results in a dropped record includes (but is not limited to): <code>"fail"</code>,
<code>"suspect"</code>, <code>"error"</code>, <code>"beyond accept"</code>, <code>"interference"</code>,
<code>"questionable"</code>, <code>"problem"</code>, <code>"violation"</code>, <code>"rejected"</code>, <code>"no data"</code>.
Specific target text varies by column.</p>
<p>84.07 thousand rows are removed and 2.04 million rows remain.</p>
<p><img src="chapters/03_chla_harmonization_files/figure-gfm/unnamed-chunk-10-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="clean-mdls" class="section level3 hasAnchor" number="4.0.5">
<h3><span class="header-section-number">4.0.5</span> 4. Clean MDLs<a href="chlorophyll-harmonization-process-strict-version.html#clean-mdls" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this step method detection limits (MDLs) are used to clean up the
reported values. When a numeric value is missing for the data record
(i.e., <code>NA</code> or text that became <code>NA</code> during an <code>as.numeric</code> call) we
check for non-detect language in the <code>ResultLaboratoryCommentText</code>,
<code>ResultCommentText</code>, <code>ResultDetectionConditionText</code>, and
<code>ResultMeasureValue</code> columns. This language can be <code>"non-detect"</code>,
<code>"not detect"</code>, <code>"non detect"</code>, <code>"undetect"</code>, or <code>"below"</code>.</p>
<p>If non-detect language exists then we use the
<code>DetectionQuantitationLimitMeasure.MeasureValue</code> column for the MDL,
otherwise if there is a <code>&lt;</code> and a number in the <code>ResultMeasureValue</code>
column we use that number instead.</p>
<p>We then use a random number between 0 and <code>0.5 * MDL</code> as the record’s
value moving forward.</p>
<p>This should not result in a change in rows but we still check: 0 rows
are removed. The final row count after this is 2.04 million.</p>
<p><img src="chapters/03_chla_harmonization_files/figure-gfm/unnamed-chunk-12-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="clean-approximate-values" class="section level3 hasAnchor" number="4.0.6">
<h3><span class="header-section-number">4.0.6</span> 5. Clean approximate values<a href="chlorophyll-harmonization-process-strict-version.html#clean-approximate-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Step 5 involves a similar process as for MDL cleaning. We flag
“approximated” values in the dataset. The <code>ResultMeasureValue</code> column
gets checked for <strong>all</strong> three of the following conditions:</p>
<ol style="list-style-type: decimal">
<li>Numeric-only version of the column is still <code>NA</code> after MDL cleaning</li>
<li>The original column text contained a number</li>
<li>Any of <code>ResultLaboratoryCommentText</code>, <code>ResultCommentText</code>, or
<code>ResultDetectionConditionText</code> match this regular expression,
ignoring case: <code>"result approx|RESULT IS APPROX|value approx"</code></li>
</ol>
<p>We then use the approximate value as the record’s value moving forward.</p>
<p>This should not result in a change in rows but we still check: 0 rows
are removed. The final row count after this is 2.04 million.</p>
<p><img src="chapters/03_chla_harmonization_files/figure-gfm/unnamed-chunk-14-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="clean-values-with-greater-than-data" class="section level3 hasAnchor" number="4.0.7">
<h3><span class="header-section-number">4.0.7</span> 6. Clean values with “greater than” data<a href="chlorophyll-harmonization-process-strict-version.html#clean-values-with-greater-than-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Step 6 is similar to the MDL and approximate value cleaning processes,
and follows the approximate cleaning process most closely. The goal is
to clean up values that were entered as “greater than” some value. The
<code>ResultMeasureValue</code> column gets checked for <strong>all</strong> three of the
following conditions:</p>
<ol style="list-style-type: decimal">
<li>Numeric-only version of the column is still <code>NA</code> after MDL &amp;
approximate cleaning</li>
<li>The original column text contained a number</li>
<li>The original column text contained a <code>&gt;</code></li>
</ol>
<p>We then use the “greater than” value (without <code>&gt;</code>) as the record’s value
moving forward.</p>
<p>This should not result in a change in rows but we still check: 0 rows
are removed. The final row count after this is 2.04 million.</p>
<p><img src="chapters/03_chla_harmonization_files/figure-gfm/unnamed-chunk-16-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="harmonize-record-units" class="section level3 hasAnchor" number="4.0.8">
<h3><span class="header-section-number">4.0.8</span> 7. Harmonize record units<a href="chlorophyll-harmonization-process-strict-version.html#harmonize-record-units" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The next step in chla harmonization is working with the units of the WQP
records. These can vary widely. We create the following conversion
table, which is used to translate units provided in WQP into
micrograms/L:</p>
<table class=" lightable-paper table" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
units
</th>
<th style="text-align:right;">
conversion
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mg/l
</td>
<td style="text-align:right;">
1e+03
</td>
</tr>
<tr>
<td style="text-align:left;">
mg/L
</td>
<td style="text-align:right;">
1e+03
</td>
</tr>
<tr>
<td style="text-align:left;">
ppm
</td>
<td style="text-align:right;">
1e+03
</td>
</tr>
<tr>
<td style="text-align:left;">
ug/l
</td>
<td style="text-align:right;">
1e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
ug/L
</td>
<td style="text-align:right;">
1e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
mg/m3
</td>
<td style="text-align:right;">
1e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
ppb
</td>
<td style="text-align:right;">
1e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
mg/cm3
</td>
<td style="text-align:right;">
1e+06
</td>
</tr>
<tr>
<td style="text-align:left;">
ug/ml
</td>
<td style="text-align:right;">
1e+03
</td>
</tr>
<tr>
<td style="text-align:left;">
mg/ml
</td>
<td style="text-align:right;">
1e+06
</td>
</tr>
<tr>
<td style="text-align:left;">
ppt
</td>
<td style="text-align:right;">
1e+06
</td>
</tr>
</tbody>
</table>
<p>This should not result in a change in rows but we still check: 1.271^{5}
rows are removed. The final row count after this is 1.91 million.</p>
<p><img src="chapters/03_chla_harmonization_files/figure-gfm/unnamed-chunk-19-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="clean-depth-data" class="section level3 hasAnchor" number="4.0.9">
<h3><span class="header-section-number">4.0.9</span> 8. Clean depth data<a href="chlorophyll-harmonization-process-strict-version.html#clean-depth-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>ActivityDepthHeightMeasure.MeasureValue</code> column is the site of our
next harmonization step. We want to both harmonize the units
(<code>ActivityDepthHeightMeasure.MeasureUnitCode</code>) used in the dataset and
set limits for depths from which we’ll accept data. We’ll use a
conversion table as with the previous units harmonization step:</p>
<table class=" lightable-paper table" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
depth_units
</th>
<th style="text-align:right;">
depth_conversion
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
in
</td>
<td style="text-align:right;">
0.0254
</td>
</tr>
<tr>
<td style="text-align:left;">
ft
</td>
<td style="text-align:right;">
0.3048
</td>
</tr>
<tr>
<td style="text-align:left;">
feet
</td>
<td style="text-align:right;">
0.3048
</td>
</tr>
<tr>
<td style="text-align:left;">
cm
</td>
<td style="text-align:right;">
0.0100
</td>
</tr>
<tr>
<td style="text-align:left;">
m
</td>
<td style="text-align:right;">
1.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
meters
</td>
<td style="text-align:right;">
1.0000
</td>
</tr>
</tbody>
</table>
<p>Once the units have been standardized we’ll make sure that the numeric
depth value is within +/-2m <strong>OR</strong> the raw character version indicates
something similar. We also keep <code>NA</code> depths to avoid losing a ton of
records. This is how it’s coded:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="chlorophyll-harmonization-process-strict-version.html#cb5-1" aria-hidden="true" tabindex="-1"></a>converted_units_chla <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="chlorophyll-harmonization-process-strict-version.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">x =</span> .,</span>
<span id="cb5-3"><a href="chlorophyll-harmonization-process-strict-version.html#cb5-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> depth_unit_conversion_table,</span>
<span id="cb5-4"><a href="chlorophyll-harmonization-process-strict-version.html#cb5-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;sample_depth_unit&quot;</span> <span class="ot">=</span> <span class="st">&quot;depth_units&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="chlorophyll-harmonization-process-strict-version.html#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">harmonized_depth_value =</span> <span class="fu">as.numeric</span>(sample_depth) <span class="sc">*</span> depth_conversion,</span>
<span id="cb5-6"><a href="chlorophyll-harmonization-process-strict-version.html#cb5-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">harmonized_depth_unit =</span> <span class="st">&quot;m&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="chlorophyll-harmonization-process-strict-version.html#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(harmonized_depth_value) <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">|</span></span>
<span id="cb5-8"><a href="chlorophyll-harmonization-process-strict-version.html#cb5-8" aria-hidden="true" tabindex="-1"></a>           sample_depth <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;0-2&quot;</span>, <span class="st">&quot;0-0.5&quot;</span>)<span class="sc">|</span></span>
<span id="cb5-9"><a href="chlorophyll-harmonization-process-strict-version.html#cb5-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(sample_depth))</span></code></pre></div>
</details>
<p><br></p>
<p>Through our depth filtering we lose 121.13 thousand rows and have 1.79
million remaining.</p>
<p><img src="chapters/03_chla_harmonization_files/figure-gfm/unnamed-chunk-23-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="filter-based-on-analytical-method" class="section level3 hasAnchor" number="4.0.10">
<h3><span class="header-section-number">4.0.10</span> 9. Filter based on analytical method<a href="chlorophyll-harmonization-process-strict-version.html#filter-based-on-analytical-method" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Our next step is to aggregate chla analytical methods into groups and
then filter out methods that may have been erroneously added, were
unclear, or which don’t meet our needs. We accomplish this using an
external match table <code>csv</code> file that is joined to the dataset. Methods
that are <code>NA</code> for their aggregated grouping or which are <code>"unlikely"</code> to
be accurate methods are dropped.</p>
<p>This process drops 2648 rows leaving 1.79 million remaining.</p>
<p><img src="chapters/03_chla_harmonization_files/figure-gfm/unnamed-chunk-25-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="filter-based-on-fraction-type" class="section level3 hasAnchor" number="4.0.11">
<h3><span class="header-section-number">4.0.11</span> 10. Filter based on fraction type<a href="chlorophyll-harmonization-process-strict-version.html#filter-based-on-fraction-type" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The final step in our chla harmonization is filtering based on the
<code>ResultSampleFractionText</code> column. We assign fractions into two
categories based on whether the fraction text makes sense or not and
then retain only those records that have a fraction with
<code>"Makes sense"</code>. Fractions included in this are
<code>"Non-Filterable (Particle)"</code>, <code>"Suspended"</code>, <code>"Non-filterable"</code>,
<code>"&lt;Blank&gt;"</code>, and <code>"Acid Soluble"</code>.</p>
<p>This process drops 116.99 thousand rows leaving 1.67 million remaining
in the final harmonized chla dataset.</p>
<p><img src="chapters/03_chla_harmonization_files/figure-gfm/unnamed-chunk-27-1.png" /><!-- --></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="pre-harmonization-decision-process.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="doc-harmonization-process-strict-version.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
